import{j as e,c as f,r as l,d as D,u as T,e as M,g as q,h as O,k as V,l as Y,t as z}from"./index-B6-Ixeg3.js";const G="_documentPage_1xdxr_13",H="_buttons_1xdxr_51",J="_overlay_1xdxr_95",K="_menu_1xdxr_121",Q="_closeButton_1xdxr_143",W="_descriptionInput_1xdxr_163",d={documentPage:G,buttons:H,overlay:J,menu:K,closeButton:Q,descriptionInput:W},X="_document_189hg_19",Z="_textarea_189hg_95",C={document:X,textarea:Z};function ee({content:n,isEditing:t,onContentChange:s}){return e.jsx("div",{className:C.document,children:t?e.jsx("textarea",{value:n,onChange:i=>s(i.target.value),className:C.textarea}):e.jsx("p",{children:n})})}const te="_overlay_194qs_1",ne="_menu_194qs_11",se="_closeButton_194qs_22",u={overlay:te,menu:ne,closeButton:se};async function p(n){return(await f.get(`/documentPermissions/getRolesByDocumentId/${n}`)).data}async function oe(n,t,s){return(await f.post(`/documentPermissions/createDocumentPermission/${n}/${t}/${s}`)).data}async function ie(n,t,s){return(await f.post(`/documentPermissions/updateDocumentPermission/${n}/${t}/${s}`)).data}async function ce(n,t){await f.delete(`/documentPermissions/deleteDocumentPermission/${n}/${t}`)}async function _(n){return(await f.get(`/documentPermissions/isCurrentUserAllowedToEditDocument/${n}`)).data}function ae({permissions:n,documentId:t,onUpdate:s}){async function i(a,r){try{await ie(t,a,r),s(await p(t))}catch{alert("Failed to update permission")}}async function c(a){try{await ce(t,a),s(await p(t))}catch{alert("Failed to delete permission")}}return n.length===0?e.jsx("li",{children:"Loading..."}):e.jsx("ul",{children:n.map((a,r)=>e.jsxs("li",{className:u.permissionItem,children:[e.jsx("span",{children:a.username}),a.role.toLowerCase()==="owner"?e.jsx("span",{className:u.ownerLabel,children:" - Owner"}):e.jsxs(e.Fragment,{children:[e.jsxs("select",{value:a.role.toLowerCase(),onChange:m=>i(a.username,m.target.value),className:u.select,children:[e.jsx("option",{value:"editor",children:"Editor"}),e.jsx("option",{value:"viewer",children:"Viewer"})]}),e.jsx("button",{onClick:()=>c(a.username),className:u.deleteButton,children:"Remove"})]})]},r))})}function le({onSave:n,onCancel:t}){const[s,i]=l.useState(""),[c,a]=l.useState("viewer");return e.jsxs("div",{className:u.editForm,children:[e.jsxs("label",{children:["Username:",e.jsx("input",{type:"text",value:s,onChange:r=>i(r.target.value),className:u.input})]}),e.jsxs("label",{children:["Role:",e.jsxs("select",{value:c,onChange:r=>a(r.target.value),className:u.select,children:[e.jsx("option",{value:"editor",children:"Editor"}),e.jsx("option",{value:"viewer",children:"Viewer"})]})]}),e.jsxs("div",{className:u.buttonRow,children:[e.jsx("button",{onClick:()=>n(s,c),className:u.saveButton,children:"Save"}),e.jsx("button",{onClick:t,className:u.cancelButton,children:"Cancel"})]})]})}function re({onClose:n}){const{id:t}=D(),s=t?parseInt(t,10):-1,[i,c]=l.useState([]),[a,r]=l.useState(!1);l.useEffect(()=>{s!==-1&&p(s).then(c).catch(h=>console.error("Failed to fetch roles:",h))},[s]);async function m(h,x){try{await oe(s,h,x);const v=await p(s);c(v),r(!1)}catch{alert("Failed to create permission")}}async function j(){await _(s)?r(!0):alert("You don't have permission to edit this document")}return e.jsx("div",{className:u.overlay,children:e.jsxs("div",{className:u.menu,children:[e.jsx("button",{className:u.closeButton,onClick:n,children:"Ã—"}),e.jsx("h1",{children:"Permissions"}),e.jsx(ae,{permissions:i,documentId:s,onUpdate:c}),a?e.jsx(le,{onSave:m,onCancel:()=>r(!1)}):e.jsx("button",{onClick:j,className:u.editButton,children:"Add Permissions"})]})})}const ue="_button_1on5r_3",de={button:ue};function me(){const[n,t]=l.useState(!1),s=l.useRef(null);function i(){t(c=>!c)}return l.useEffect(()=>{function c(a){s.current&&!s.current.contains(a.target)&&t(!1)}return n?document.addEventListener("mousedown",c):document.removeEventListener("mousedown",c),()=>{document.removeEventListener("mousedown",c)}},[n]),e.jsxs("div",{ref:s,style:{position:"relative",display:"inline-block"},children:[e.jsx("button",{onClick:i,className:de.button,children:"Document Permissions"}),n&&e.jsx(re,{onClose:()=>t(!1)})]})}const he="_overlay_17o6s_3",xe="_menu_17o6s_13",fe="_closeButton_17o6s_24",g={overlay:he,menu:xe,closeButton:fe};function pe({document:n,onClose:t}){return e.jsx("div",{className:g.overlay,children:e.jsxs("div",{className:g.menu,children:[e.jsx("button",{className:g.closeButton,onClick:t,children:"Ã—"}),e.jsx("h2",{children:"ðŸ“„ Document Info"}),e.jsxs("p",{children:[e.jsx("strong",{children:"ID:"})," ",n.id]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," ",n.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Public:"})," ",n.isPublic?"Yes":"No"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Created At:"})," ",new Date(n.createdAt).toLocaleString()]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Updated At:"})," ",new Date(n.updatedAt).toLocaleString()]})]})})}function ve(){const n=D(),t=Number(n.id),[s,i]=l.useState({id:0,name:"Untitled Document",description:"Default description",content:"Document Content",isPublic:!1}),[c,a]=l.useState(!1),[r,m]=l.useState(!1),[j,h]=l.useState(!1),[x,v]=l.useState(s.description),[w,b]=l.useState(!1),[y,P]=l.useState(null),N=T();l.useEffect(()=>{M(t).then(o=>i(o)).catch(()=>i({id:-1,name:"Error",description:"Failed to load",content:"Failed to load",isPublic:!1})),_(t).then(()=>a(!0))},[t]);function E(o){i(A=>({...A,content:o}))}function B(){q(t,s.content).then(()=>{alert("Changes saved successfully"),m(!1)}).catch(o=>{console.error(o),alert("Failed to save changes.")})}function S(){O(t).then(()=>{i({id:-1,name:"",description:"",content:"",isPublic:!1}),m(!1),navigator.clipboard.writeText(window.location.href).then(()=>alert("Removed The Document Successfully!")).catch(o=>console.error("Copied URL failed",o)),N("/documents")}).catch(o=>{console.error("Delete failed",o),alert("Failed to delete the document!")})}function k(){navigator.clipboard.writeText(window.location.href).then(()=>alert("URL copied to clipboard!")).catch(o=>console.error("Failed to copy URL",o))}function I(){m(!0)}function $(){m(!1)}function F(){h(!0)}function R(){V(t,x).then(()=>{i(o=>({...o,description:x})),h(!1),alert("Description updated successfully")}).catch(()=>alert("Failed to update description"))}function L(){Y(t).then(o=>{P(o),b(!0)}).catch(()=>alert("Failed to fetch document info"))}function U(){z(t).then(()=>{i(o=>({...o,isPublic:!o.isPublic}))}).catch(()=>alert("Failed to toggle public (Only owner can change visibility)"))}return e.jsxs("div",{className:d.documentPage,children:[e.jsxs("div",{className:d.buttons,children:[c&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:U,style:{backgroundColor:s.isPublic?"green":"red",transition:"background-color 0.3s ease"},children:s.isPublic?"Public":"Private"}),e.jsx("button",{onClick:B,children:"Save Changes"}),e.jsx("button",{onClick:S,children:"Delete"})]}),!r&&e.jsxs(e.Fragment,{children:[c&&e.jsx("button",{onClick:I,children:"Edit"}),e.jsx("button",{onClick:k,children:"Share"}),e.jsx(me,{})]}),r&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:$,children:"Exit Editing"}),e.jsx("button",{onClick:F,children:"Update Description"})]}),j&&e.jsx("div",{className:d.overlay,children:e.jsxs("div",{className:d.menu,children:[e.jsx("button",{className:d.closeButton,onClick:()=>h(!1),children:"Ã—"}),e.jsx("h2",{children:"Edit Description"}),e.jsx("textarea",{className:d.descriptionInput,value:x,onChange:o=>v(o.target.value),placeholder:"Type your new description..."}),e.jsxs("div",{className:d.buttonRow,children:[e.jsx("button",{onClick:R,className:d.saveButton,children:"Save"}),e.jsx("button",{onClick:()=>h(!1),className:d.cancelButton,children:"Cancel"})]})]})})]}),e.jsx("h1",{children:s.name}),e.jsx(ee,{content:s.content,isEditing:r,onContentChange:E}),e.jsx("button",{onClick:L,children:"Document Info"}),w&&y&&e.jsx(pe,{document:y,onClose:()=>b(!1)})]})}export{ve as default};
